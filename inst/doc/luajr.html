<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to luajr</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to <code>luajr</code></h1>



<p>luajr allows you to run <a href="https://www.lua.org">Lua</a> code
from R.</p>
<p>Lua is a lightweight, simple, and fast scripting language that is
used in a variety of settings. The standard Lua interpreter is already
reasonably fast, but there is also a just-in-time compiler for Lua
called <a href="https://luajit.org">LuaJIT</a> that is even faster.
luajr uses LuaJIT.</p>
<p>This is <strong>not</strong> a guide to Lua or LuaJIT; it is a
quick-start guide to luajr for people who already know how to program in
Lua. See the <a href="https://www.lua.org">Lua web site</a> for
resources related to coding in Lua.</p>
<div id="running-lua-code-lua-and-lua_shell" class="section level1">
<h1>Running Lua code: <code>lua()</code> and
<code>lua_shell()</code></h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(luajr)</span></code></pre></div>
<p>To get a feel for luajr or to run “one-off” Lua code from your R
project, use <code>lua()</code> and <code>lua_shell()</code>.</p>
<p>When you pass a character string to <code>lua()</code>, it is run as
Lua code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return &#39;Hello &#39; .. &#39;world!&#39;&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Hello world!&quot;</span></span></code></pre></div>
<p>Assignments to global variables will persist between calls to
<code>lua()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;my_animal = &#39;walrus&#39;&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return my_animal&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;walrus&quot;</span></span></code></pre></div>
<p>This is because luajr maintains a “default Lua state” which holds all
global variables. This default Lua state is opened the first time a
package function is used. You can create your own, separate Lua states,
or reset the default Lua state (see <a href="#states">Lua states</a>,
below).</p>
<p>Assignments to local variables will <em>not</em> persist between
calls to <code>lua()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;local my_animal = &#39;donkey&#39;&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return my_animal&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;walrus&quot;</span></span></code></pre></div>
<p>In this case, the second line returns <code>&quot;walrus&quot;</code> because
the local variable <code>my_animal</code> goes out of scope after the
first call to <code>lua()</code> ends, so the second call to
<code>lua()</code> is referring back to the global variable
<code>my_animal</code> from before.</p>
<p>You can include more than one statement in the code run by
<code>lua()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;local my_veg = &#39;potato&#39;; local my_dish = my_veg .. &#39; pie&#39;; return my_dish&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;potato pie&quot;</span></span></code></pre></div>
<p>You can also use the <code>filename</code> argument to
<code>lua()</code> to load and run a Lua source file, instead of running
the contents of a string.</p>
<p>Call <code>lua_shell()</code> to open an interactive Lua shell at the
R prompt. This can can be helpful for debugging or for testing Lua
statements.</p>
</div>
<div id="calling-lua-functions-from-r-lua_func" class="section level1">
<h1>Calling Lua functions from R: <code>lua_func()</code></h1>
<p>The key piece of functionality for luajr is probably
<code>lua_func()</code>. This allows you to call Lua functions from
R.</p>
<p>The first argument to <code>lua_func()</code>, <code>func</code>, is
a string that should evaluate to a Lua function. <code>lua_func()</code>
then returns an R function that can be used to call that Lua function
from R. For example, you can use <code>lua_func()</code> to access an
existing Lua function from R:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>luatype <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;type&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">luatype</span>(<span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;boolean&quot;</span></span></code></pre></div>
<p>Here, <code>&quot;type&quot;</code> is just referring to the built-in Lua
function <code>type</code> which returns a string describing the Lua
type of the value passed to it. You can also use <code>lua_func()</code>
to refer to a previously defined function in the default Lua state:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;function squared(x) return x^2 end&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return squared(4)&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; [1] 16</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>sq <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;squared&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="fu">sq</span>(<span class="dv">8</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; [1] 64</span></span></code></pre></div>
<p>Or you can use <code>lua_func()</code> to define an anonymous Lua
function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>timestwo <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) return x*2 end&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">timestwo</span>(<span class="dv">123</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; [1] 246</span></span></code></pre></div>
<p>Under the hood, <code>lua_func()</code> just takes its first
parameter (a string), adds <code>&quot;return &quot;</code> to the front of it,
executes it as Lua code, and registers the result as the function.</p>
<p>The second argument to <code>lua_func()</code>, <code>argcode</code>,
is also very important. <code>argcode</code> determines how the
arguments passed to the function from R are translated into Lua values
for use inside the function.</p>
<p>The permissible arg codes are:</p>
<ul>
<li><code>&#39;s&#39;</code>: <strong>s</strong>implest Lua type (the
default)</li>
<li><code>&#39;a&#39;</code>: <strong>a</strong>rray type</li>
<li><code>&#39;1&#39;</code>: same as <code>&#39;s&#39;</code>, but require that the
argument has length 1</li>
<li>…</li>
<li><code>&#39;9&#39;</code>: same as <code>&#39;s&#39;</code>, but require that the
argument has length 9</li>
<li><code>&#39;v&#39;</code>: pass by <strong>v</strong>alue</li>
<li><code>&#39;r&#39;</code>: pass by <strong>r</strong>eference</li>
</ul>
<p>The kinds of R values that can be passed to Lua functions, and their
behaviour under different arg codes, is summarized in the following
table:</p>
<table>
<colgroup>
<col width="8%" />
<col width="8%" />
<col width="9%" />
<col width="9%" />
<col width="6%" />
<col width="9%" />
<col width="24%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">R type</th>
<th align="center">Example R value</th>
<th><strong>arg code</strong> ‘s’</th>
<th>‘a’</th>
<th>‘1’</th>
<th>‘2’</th>
<th>‘v’</th>
<th>‘r’</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>NULL</code></td>
<td align="center"><code>NULL</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
</tr>
<tr class="even">
<td align="center"><code>logical(1)</code></td>
<td align="center"><code>TRUE</code></td>
<td><code>true</code></td>
<td><code>{true}</code></td>
<td><code>true</code></td>
<td><strong>error</strong></td>
<td><code>luajr.logical({true})</code></td>
<td><code>luajr.logical_r({true})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>integer(1)</code></td>
<td align="center"><code>1L</code></td>
<td><code>1</code></td>
<td><code>{1}</code></td>
<td><code>1</code></td>
<td><strong>error</strong></td>
<td><code>luajr.integer({1})</code></td>
<td><code>luajr.integer_r({1})</code></td>
</tr>
<tr class="even">
<td align="center"><code>numeric(1)</code></td>
<td align="center"><code>3.14159</code></td>
<td><code>3.14159</code></td>
<td><code>{3.14159}</code></td>
<td><code>3.14149</code></td>
<td><strong>error</strong></td>
<td><code>luajr.numeric({3.14159})</code></td>
<td><code>luajr.numeric_r({3.14159})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>character(1)</code></td>
<td align="center"><code>&quot;howdy&quot;</code></td>
<td><code>&quot;howdy&quot;</code></td>
<td><code>{&quot;howdy&quot;}</code></td>
<td><code>&quot;howdy&quot;</code></td>
<td><strong>error</strong></td>
<td><code>luajr.character({&quot;howdy&quot;})</code></td>
<td><code>luajr.character_r({&quot;howdy&quot;})</code></td>
</tr>
<tr class="even">
<td align="center"><code>logical(nn)</code></td>
<td align="center"><code>c(TRUE, FALSE)</code></td>
<td><code>{true, false}</code></td>
<td><code>{true, false}</code></td>
<td><strong>error</strong></td>
<td><code>{true, false}</code></td>
<td><code>luajr.logical({true, false})</code></td>
<td><code>luajr.logical_r({true, false})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>integer(nn)</code></td>
<td align="center"><code>1:2</code></td>
<td><code>{1, 2}</code></td>
<td><code>{1.0, 2.0}</code></td>
<td><strong>error</strong></td>
<td><code>{1.0, 2.0}</code></td>
<td><code>luajr.integer({1, 2})</code></td>
<td><code>luajr.integer_r({1, 2})</code></td>
</tr>
<tr class="even">
<td align="center"><code>numeric(nn)</code></td>
<td align="center"><code>exp(0:1)</code></td>
<td><code>{1, 2.71828...}</code></td>
<td><code>{1, 2.71828...}</code></td>
<td><strong>error</strong></td>
<td><code>{1, 2.71828...}</code></td>
<td><code>luajr.numeric({1, 2.71828...})</code></td>
<td><code>luajr.numeric_r({1, 2.71828...})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>character(nn)</code></td>
<td align="center"><code>letters[1:2]</code></td>
<td><code>{&quot;a&quot;, &quot;b&quot;}</code></td>
<td><code>{&quot;a&quot;, &quot;b&quot;}</code></td>
<td><strong>error</strong></td>
<td><code>{&quot;a&quot;, &quot;b&quot;}</code></td>
<td><code>luajr.character({&quot;a&quot;, &quot;b&quot;})</code></td>
<td><code>luajr.character_r({&quot;a&quot;, &quot;b&quot;})</code></td>
</tr>
<tr class="even">
<td align="center"><code>list(...)</code></td>
<td align="center"><code>list(1, b=&#39;b&#39;)</code></td>
<td><code>{[1]=1, b=&#39;b&#39;}</code></td>
<td><strong>error</strong></td>
<td><strong>error</strong></td>
<td><strong>error</strong></td>
<td><code>x = luajr.list(); x[1] = luajr.numeric({1});</code><br /><code>x.b = luajr.character({&#39;b&#39;}); return x</code></td>
<td><code>x = luajr.list(); x[1] = luajr.numeric_r({1});</code><br /><code>x.b = luajr.character_r({&#39;b&#39;}); return x</code></td>
</tr>
<tr class="odd">
<td align="center">external pointer</td>
<td align="center"><code>lua_open()</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
</tr>
</tbody>
</table>
<p>Above, <code>nn</code> stands for an integer that is greater than 1;
in the examples, it stands specifically for 2.</p>
<p>There should be one character in <code>argcode</code> for every
argument of the function, but the string is “recycled” when there are
more arguments passed than characters in the <code>argcode</code>
string. So, for example, just passing <code>&quot;s&quot;</code> as
<code>argcode</code> means all parameters will be passed as the
<strong>s</strong>implest Lua type, while if <code>argcode</code> is
<code>&quot;sr&quot;</code>, then the first argument has arg code
<code>&quot;s&quot;</code>, the second argument has arg code <code>&quot;r&quot;</code>, the
third argument has arg code <code>&quot;s&quot;</code>, etc.</p>
<p>When a vector (logical vector, integer vector, numeric vector, or
character vector) is passed from R to Lua by <strong>r</strong>eference,
modifications made to the elements of that passed-in vector persist back
in the R calling frame. For example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>values <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>keep <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1] = 999 end&quot;</span>, <span class="st">&quot;v&quot;</span>) <span class="co"># passed by value</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">keep</span>(values)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">print</span>(values)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; [1] 1 2 3</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>change <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1] = 999 end&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="co"># passed by reference</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="fu">change</span>(values)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">print</span>(values)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; [1] 999   2   3</span></span></code></pre></div>
<p>Vectors can never be resized by reference; only their
already-existing elements can be changed by reference.</p>
<p>Lists are always passed by value, but their vector elements can be
either passed by value or by reference depending on the arg code. In
order to make changes to a list, it needs to be returned to the calling
function. For example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">1</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>f1 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1][1] = 999; x.a = 42; end&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="fu">f1</span>(x)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>f2 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1][1] = 999; x.a = 42; end&quot;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">f2</span>(x)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; [1] 999</span></span></code></pre></div>
<p>Note that in the examples above, we modify <code>x[1][1]</code>, not
just <code>x[1]</code>. That is because, even when lists are passed by
reference, we need to modify specific elements of their vector elements
if we want to make changes by reference. Setting <code>x[1] = 999</code>
would only reassign an element of the list <code>x</code>, and lists
cannot be passed by reference itself, so this would have no effect on
the R object passed in. By contrast, setting <code>x[1][1] = 999</code>
modifies the passed-in vector <code>x[1]</code>, which can be passed in
by reference, so this does change the R object that is passed in.</p>
<p>To modify a list, we have to return its new value from the
function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>f3 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1][1] = 999; x.a = 42; return x; end&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">f3</span>(x)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; [1] 999</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; $a</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; [1] 42</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>f4 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1] = luajr.numeric({888, 999}); return x; end&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">f4</span>(x)</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; [1] 888 999</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; $a</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; [1] 42</span></span></code></pre></div>
<p>Here, because we are returning a modified value, we can add elements
to the list (<code>f3</code>) and change whole entries of the list
(<code>f4</code>).</p>
</div>
<div id="benchmarking" class="section level1">
<h1>Benchmarking</h1>
<p>In the same way that using R packages <a href="https://CRAN.R-project.org/package=cpp11">cpp11</a> or <a href="https://CRAN.R-project.org/package=Rcpp">Rcpp</a> allows you to
bridge your R code with C++ code that runs faster than R, you can use
<code>luajr</code> to bridge your R code with Lua code that runs faster
than R.</p>
<p>In general, C/C++ code runs about 5-1,000 times faster than the
equivalent R code.</p>
<p>In my experience, luajr code often presents a similar speedup, about
the same as C/C++ code, or in the worst case, maybe half as fast.
Sometimes luajr code can be faster than C/C++, though usually it isn’t
quite as good.</p>
<p>Why use luajr then? Rcpp and cpp11 require a C++ toolchain (e.g. gcc,
clang, etc.) and requires long compilation times, whereas luajr doesn’t.
This means that luajr is usable when a C++ compiler isn’t available, or
when compilation times are prohibitive or an annoyance.</p>
<p>In the following section, we look at two aspects of benchmarking. In
the first example, we compare different ways of passing vectors to Lua
functions relative to R. In the second example, we compare more
fundamentally the difference in running a whole algorithm in Lua versus
R.</p>
<div id="parameter-passing-example-sum-of-squares" class="section level2">
<h2>Parameter passing example: sum of squares</h2>
<p>For reasonably long vectors, passing by reference (<code>&#39;r&#39;</code>)
is faster than passing by value (<code>&#39;v&#39;</code>), which is faster than
passing by simplify (<code>&#39;s&#39;</code>, <code>&#39;a&#39;</code>, or
<code>&#39;1&#39;</code>–<code>&#39;9&#39;</code>). But for relatively short vectors,
passing by simplify can avoid some overhead, and for very simple
operations on very short vectors, it might not be worth using Lua at
all.</p>
<p>To illustrate the above points, here is some code that takes a
numeric vector and calculates the sum of squares, comparing a pure R
function with three alternatives written in Lua, respectively passing
the vector by reference, by value, and by simplify.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>v1 <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>v4 <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>v7 <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e7</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;sum2 = function(x) local s = 0; for i=1,#x do s = s + x[i]*x[i] end; return s end&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>sum2 <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">*</span>x)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>sum2_r <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;sum2&quot;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>sum2_v <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;sum2&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>sum2_s <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;sum2&quot;</span>, <span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co"># Comparing the results of each function:</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="fu">sum2</span>(v1)    <span class="co"># Pure R version</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; [1] 6.83011</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="fu">sum2_r</span>(v1)  <span class="co"># luajr pass-by-reference</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; [1] 6.83011</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="fu">sum2_v</span>(v1)  <span class="co"># luajr pass-by-value</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; [1] 6.83011</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="fu">sum2_s</span>(v1)  <span class="co"># luajr pass-by-simplify</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; [1] 6.83011</span></span></code></pre></div>
<p>The time taken to sum <code>v1</code>, <code>v4</code> and
<code>v7</code>, depending upon the function kind, on a 2019-era MacBook
Pro is summarised in this table:</p>
<table>
<colgroup>
<col width="20%" />
<col width="24%" />
<col width="34%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Call</th>
<th align="center">Number of summands</th>
<th align="center">Method</th>
<th align="right">Median runtime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>sum2(v1)</code></td>
<td align="center">10</td>
<td align="center">Pure R</td>
<td align="right"><strong>1 µs</strong></td>
</tr>
<tr class="even">
<td align="left"><code>sum2_r(v1)</code></td>
<td align="center">10</td>
<td align="center"><code>luajr</code> pass by reference</td>
<td align="right">6 µs</td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_v(v1)</code></td>
<td align="center">10</td>
<td align="center"><code>luajr</code> pass by value</td>
<td align="right">7 µs</td>
</tr>
<tr class="even">
<td align="left"><code>sum2_s(v1)</code></td>
<td align="center">10</td>
<td align="center"><code>luajr</code> pass by simplify</td>
<td align="right">4 µs</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left"><code>sum2(v4)</code></td>
<td align="center">10,000</td>
<td align="center">Pure R</td>
<td align="right">63 µs</td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_r(v4)</code></td>
<td align="center">10,000</td>
<td align="center"><code>luajr</code> pass by reference</td>
<td align="right"><strong>18 µs</strong></td>
</tr>
<tr class="even">
<td align="left"><code>sum2_v(v4)</code></td>
<td align="center">10,000</td>
<td align="center"><code>luajr</code> pass by value</td>
<td align="right">93 µs</td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_s(v4)</code></td>
<td align="center">10,000</td>
<td align="center"><code>luajr</code> pass by simplify</td>
<td align="right">78 µs</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><code>sum2(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center">Pure R</td>
<td align="right">49,000 µs</td>
</tr>
<tr class="even">
<td align="left"><code>sum2_r(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center"><code>luajr</code> pass by reference</td>
<td align="right"><strong>13,000 µs</strong></td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_v(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center"><code>luajr</code> pass by value</td>
<td align="right">96,000 µs</td>
</tr>
<tr class="even">
<td align="left"><code>sum2_s(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center"><code>luajr</code> pass by simplify</td>
<td align="right">124,000 µs</td>
</tr>
</tbody>
</table>
<p>When the vector is 10 elements long, the R version wins handily.</p>
<p>When the vector is 10,000 elements long, the pass-by-reference Lua
version is fastest, but the other methods are all comparable.</p>
<p>When the vector is 10,000,000 elements long, the story is
similar.</p>
<p>This is an example where luajr doesn’t add that much speed—the
function is relatively short, and there is a certain amount of overhead
in invoking it, while the R function doesn’t have the overhead of
transferring control between languages.</p>
</div>
<div id="processing-time-example-logistic-map" class="section level2">
<h2>Processing time example: logistic map</h2>
<p>Consider the following:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>logistic_map_R <span class="ot">=</span> <span class="cf">function</span>(x0, burn, iter, A)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>{</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    result_x <span class="ot">=</span> <span class="fu">numeric</span>(<span class="fu">length</span>(A) <span class="sc">*</span> iter)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    j <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="cf">for</span> (a <span class="cf">in</span> A) {</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>        x <span class="ot">=</span> x0</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>burn) { </span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>            x <span class="ot">=</span> a <span class="sc">*</span> x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>        }</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter) { </span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>            result_x[j] <span class="ot">=</span> x</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>            x <span class="ot">=</span> a <span class="sc">*</span> x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>            j <span class="ot">=</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>        }</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>    }</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    </span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>    <span class="fu">return</span> (<span class="fu">list2DF</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">rep</span>(A, <span class="at">each =</span> iter), <span class="at">x =</span> result_x)))</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>}</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>logistic_map_L <span class="ot">=</span> <span class="fu">lua_func</span>(</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="st">&quot;function(x0, burn, iter, A)</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="st">    local dflen = #A * iter</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="st">    local result = luajr.dataframe()</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="st">    result.a = luajr.numeric_r(dflen, 0)</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="st">    result.x = luajr.numeric_r(dflen, 0)</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="st">    local j = 1</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="st">    for k,a in pairs(A) do</span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="st">        local x = x0</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="st">        for i = 1, burn do</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="st">            x = a * x * (1 - x)</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="st">        end</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="st">        for i = 1, iter do</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="st">            result.a[j] = a</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="st">            result.x[j] = x</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="st">            x = a * x * (1 - x)</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="st">            j = j + 1</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="st">        end</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="st">    end</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="st">    return result</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="st">end&quot;</span>, <span class="st">&quot;sssr&quot;</span>)</span></code></pre></div>
<p>Here we are comparing two different versions (R versus Lua) of
running a parameter sweep of the logistic map, a chaotic dynamical
system popularized by Bob May in a <a href="https://sites.ifi.unicamp.br/aguiar/files/2014/10/May-Nature-1976.pdf">1976
Nature article</a>. The output looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>logistic_map <span class="ot">=</span> <span class="fu">logistic_map_L</span>(<span class="fl">0.5</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span><span class="sc">:</span><span class="dv">385</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">plot</span>(logistic_map<span class="sc">$</span>a, logistic_map<span class="sc">$</span>x, <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>The times taken by each function on a 2019-era MacBook Pro are as
follows:</p>
<table>
<colgroup>
<col width="56%" />
<col width="23%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th>Call</th>
<th>Method</th>
<th align="right">Median runtime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>logistic_map_R(0.5, 50, 100, 200:385/100))</code></td>
<td>R function</td>
<td align="right">1900 µs</td>
</tr>
<tr class="even">
<td><code>logistic_map_L(0.5, 50, 100, 200:385/100))</code></td>
<td>Lua function</td>
<td align="right"><strong>200 µs</strong></td>
</tr>
</tbody>
</table>
<p>The version written in Lua is around 10 times faster than the version
in R.</p>
<p>The speedup was much more notable in an earlier test where the R
version first created the data frame and then performed the iteration,
i.e. with the line <code>result$x[j] = x</code> instead of
<code>result_x[j] = x</code>. The median runtime for that R version was
two orders of magnitude slower; the extra overhead associated with
<code>data.frame</code> methods was pointed out by Tim Taylor.</p>
</div>
</div>
<div id="states" class="section level1">
<h1>Working with Lua States: <code>lua_open()</code>,
<code>lua_reset()</code></h1>
<p>All the functions mentioned above (<code>lua()</code>,
<code>lua_shell()</code>, and <code>lua_func()</code>) can also take an
argument <code>L</code> that specifies a particular Lua state that the
function operates in.</p>
<p>When <code>L = NULL</code> (the default) the functions operate on the
default Lua state.</p>
<p>But you can also open alternative Lua states using
<code>lua_open()</code>, and then by passing the result as the parameter
<code>L</code>, specify that the function operates in that specific
state. For example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>L1 <span class="ot">=</span> <span class="fu">lua_open</span>()</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;a = 2&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;a = 4&quot;</span>, <span class="at">L =</span> L1)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>, <span class="at">L =</span> L1)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>There is no <code>lua_close</code> in luajr because Lua states are
closed automatically when they are garbage collected in R.</p>
<p><code>lua_reset()</code> resets the default Lua state:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;a = 2&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">lua_reset</span>()</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>To reset a non-default Lua state <code>L</code> returned by
<code>lua_open()</code>, just do <code>L = lua_open()</code> again. The
memory previously used by <code>L</code> will be cleaned up at the next
garbage collection.</p>
</div>
<div id="further-reading" class="section level1">
<h1>Further reading</h1>
<p>For notes on the <code>luajr</code> Lua module – which contains
functions and types for interacting with R from Lua code – see
<code>vignette(&quot;luajr-module&quot;)</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
