<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to luajr</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to <code>luajr</code></h1>



<p><code>luajr</code> allows you to run <a href="https://www.lua.org">Lua</a> code from R.</p>
<p>Lua is a lightweight, simple, and fast scripting language that is
used in a variety of settings. The standard Lua interpreter is already
reasonably fast, but there is also a just-in-time compiler for Lua
called <a href="https://luajit.org">LuaJIT</a> that is even faster.
<code>luajr</code> uses LuaJIT.</p>
<p>This is <strong>not</strong> a guide to Lua or LuaJIT; it is a
quick-start guide to <code>luajr</code> for people who already know how
to program in Lua. See the <a href="https://www.lua.org">Lua web
site</a> for resources related to coding in Lua.</p>
<div id="running-lua-code-lua-and-lua_shell" class="section level2">
<h2>Running Lua code: <code>lua()</code> and
<code>lua_shell()</code></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(luajr)</span></code></pre></div>
<p>To get a feel for <code>luajr</code> or to run “one-off” Lua code
from your R project, use <code>lua()</code> and
<code>lua_shell()</code>.</p>
<p>When you pass a character string to <code>lua()</code>, it is run as
Lua code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return &#39;Hello &#39; .. &#39;world!&#39;&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Hello world!&quot;</span></span></code></pre></div>
<p>Assignments to global variables will persist between calls to
<code>lua()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;my_animal = &#39;walrus&#39;&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return my_animal&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;walrus&quot;</span></span></code></pre></div>
<p>This is because <code>luajr</code> maintains a “default Lua state”
which holds all global variables. This default Lua state is opened the
first time a package function is used. You can create your own, separate
Lua states, or reset the default Lua state (see <a href="#states">Lua
states</a>, below).</p>
<p>Assignments to local variables will <em>not</em> persist between
calls to <code>lua()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;local my_animal = &#39;donkey&#39;&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return my_animal&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;walrus&quot;</span></span></code></pre></div>
<p>In this case, the second line returns <code>&quot;walrus&quot;</code> because
the local variable <code>my_animal</code> goes out of scope after the
first call to <code>lua()</code> ends, so the second call to
<code>lua()</code> is referring back to the global variable
<code>my_animal</code> from before.</p>
<p>You can include more than one statement in the code run by
<code>lua()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;local my_veg = &#39;potato&#39;; local my_dish = my_veg .. &#39; pie&#39;; return my_dish&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;potato pie&quot;</span></span></code></pre></div>
<p>You can also use the <code>filename</code> argument to
<code>lua()</code> to load and run a Lua source file, instead of running
the contents of a string.</p>
<p>Call <code>lua_shell()</code> to open an interactive Lua shell at the
R prompt. This can can be helpful for debugging or for testing Lua
statements.</p>
</div>
<div id="calling-lua-functions-from-r-lua_func" class="section level2">
<h2>Calling Lua functions from R: <code>lua_func()</code></h2>
<p>The key piece of functionality for <code>luajr</code> is probably
<code>lua_func()</code>. This allows you to call Lua functions from
R.</p>
<p>The first argument to <code>lua_func()</code>, <code>func</code>, is
a string that should evaluate to a Lua function. <code>lua_func()</code>
then returns an R function that can be used to call that Lua function
from R. For example, you can use <code>lua_func()</code> to access an
existing Lua function from R:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>luatype <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;type&quot;</span>)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">luatype</span>(<span class="cn">TRUE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;boolean&quot;</span></span></code></pre></div>
<p>Here, <code>&quot;type&quot;</code> is just referring to the built-in Lua
function <code>type</code> which returns a string describing the Lua
type of the value passed to it. You can also use <code>lua_func()</code>
to refer to a previously defined function in the default Lua state:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;function squared(x) return x^2 end&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return squared(4)&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; [1] 16</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>sq <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;squared&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="fu">sq</span>(<span class="dv">8</span>)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; [1] 64</span></span></code></pre></div>
<p>Or you can use <code>lua_func()</code> to define an anonymous Lua
function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>timestwo <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) return x*2 end&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">timestwo</span>(<span class="dv">123</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; [1] 246</span></span></code></pre></div>
<p>Under the hood, <code>lua_func()</code> just takes its first
parameter (a string), adds <code>&quot;return &quot;</code> to the front of it,
executes it as Lua code, and registers the result as the function.</p>
<p>The second argument to <code>lua_func()</code>, <code>argcode</code>,
is also very important. <code>argcode</code> determines how the
arguments passed to the function from R are translated into Lua values
for use inside the function.</p>
<p>The permissible arg codes are:</p>
<ul>
<li><code>&#39;s&#39;</code>: <strong>s</strong>implest Lua type (the
default)</li>
<li><code>&#39;a&#39;</code>: <strong>a</strong>rray type</li>
<li><code>&#39;1&#39;</code>: same as <code>&#39;s&#39;</code>, but require that the
argument has length 1</li>
<li>…</li>
<li><code>&#39;9&#39;</code>: same as <code>&#39;s&#39;</code>, but require that the
argument has length 9</li>
<li><code>&#39;v&#39;</code>: pass by <strong>v</strong>alue</li>
<li><code>&#39;r&#39;</code>: pass by <strong>r</strong>eference</li>
</ul>
<p>The kinds of R values that can be passed to Lua functions, and their
behaviour under different arg codes, is summarized in the following
table:</p>
<table>
<colgroup>
<col width="8%" />
<col width="8%" />
<col width="9%" />
<col width="9%" />
<col width="6%" />
<col width="9%" />
<col width="24%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">R type</th>
<th align="center">Example R value</th>
<th><strong>arg code</strong> ‘s’</th>
<th>‘a’</th>
<th>‘1’</th>
<th>‘2’</th>
<th>‘v’</th>
<th>‘r’</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>NULL</code></td>
<td align="center"><code>NULL</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
<td><code>nil</code></td>
</tr>
<tr class="even">
<td align="center"><code>logical(1)</code></td>
<td align="center"><code>TRUE</code></td>
<td><code>true</code></td>
<td><code>{true}</code></td>
<td><code>true</code></td>
<td><strong>error</strong></td>
<td><code>luajr.logical({true})</code></td>
<td><code>luajr.logical_r({true})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>integer(1)</code></td>
<td align="center"><code>1L</code></td>
<td><code>1</code></td>
<td><code>{1}</code></td>
<td><code>1</code></td>
<td><strong>error</strong></td>
<td><code>luajr.integer({1})</code></td>
<td><code>luajr.integer_r({1})</code></td>
</tr>
<tr class="even">
<td align="center"><code>numeric(1)</code></td>
<td align="center"><code>3.14159</code></td>
<td><code>3.14159</code></td>
<td><code>{3.14159}</code></td>
<td><code>3.14149</code></td>
<td><strong>error</strong></td>
<td><code>luajr.numeric({3.14159})</code></td>
<td><code>luajr.numeric_r({3.14159})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>character(1)</code></td>
<td align="center"><code>&quot;howdy&quot;</code></td>
<td><code>&quot;howdy&quot;</code></td>
<td><code>{&quot;howdy&quot;}</code></td>
<td><code>&quot;howdy&quot;</code></td>
<td><strong>error</strong></td>
<td><code>luajr.character({&quot;howdy&quot;})</code></td>
<td><code>luajr.character_r({&quot;howdy&quot;})</code></td>
</tr>
<tr class="even">
<td align="center"><code>logical(nn)</code></td>
<td align="center"><code>c(TRUE, FALSE)</code></td>
<td><code>{true, false}</code></td>
<td><code>{true, false}</code></td>
<td><strong>error</strong></td>
<td><code>{true, false}</code></td>
<td><code>luajr.logical({true, false})</code></td>
<td><code>luajr.logical_r({true, false})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>integer(nn)</code></td>
<td align="center"><code>1:2</code></td>
<td><code>{1, 2}</code></td>
<td><code>{1.0, 2.0}</code></td>
<td><strong>error</strong></td>
<td><code>{1.0, 2.0}</code></td>
<td><code>luajr.integer({1, 2})</code></td>
<td><code>luajr.integer_r({1, 2})</code></td>
</tr>
<tr class="even">
<td align="center"><code>numeric(nn)</code></td>
<td align="center"><code>exp(0:1)</code></td>
<td><code>{1, 2.71828...}</code></td>
<td><code>{1, 2.71828...}</code></td>
<td><strong>error</strong></td>
<td><code>{1, 2.71828...}</code></td>
<td><code>luajr.numeric({1, 2.71828...})</code></td>
<td><code>luajr.numeric_r({1, 2.71828...})</code></td>
</tr>
<tr class="odd">
<td align="center"><code>character(nn)</code></td>
<td align="center"><code>letters[1:2]</code></td>
<td><code>{&quot;a&quot;, &quot;b&quot;}</code></td>
<td><code>{&quot;a&quot;, &quot;b&quot;}</code></td>
<td><strong>error</strong></td>
<td><code>{&quot;a&quot;, &quot;b&quot;}</code></td>
<td><code>luajr.character({&quot;a&quot;, &quot;b&quot;})</code></td>
<td><code>luajr.character_r({&quot;a&quot;, &quot;b&quot;})</code></td>
</tr>
<tr class="even">
<td align="center"><code>list(...)</code></td>
<td align="center"><code>list(1, b=&#39;b&#39;)</code></td>
<td><code>{[1]=1, b=&#39;b&#39;}</code></td>
<td><strong>error</strong></td>
<td><strong>error</strong></td>
<td><strong>error</strong></td>
<td><code>x = luajr.list(); x[1] = luajr.numeric({1});</code><br /><code>x.b = luajr.character({&#39;b&#39;}); return x</code></td>
<td><code>x = luajr.list(); x[1] = luajr.numeric_r({1});</code><br /><code>x.b = luajr.character_r({&#39;b&#39;}); return x</code></td>
</tr>
<tr class="odd">
<td align="center">external pointer</td>
<td align="center"><code>lua_open()</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
<td><code>userdata:…</code></td>
</tr>
</tbody>
</table>
<p>Above, <code>nn</code> stands for an integer that is greater than 1;
in the examples, it stands specifically for 2.</p>
<p>There should be one character in <code>argcode</code> for every
argument of the function, but the string is “recycled” when there are
more arguments passed than characters in the <code>argcode</code>
string. So, for example, just passing <code>&quot;s&quot;</code> as
<code>argcode</code> means all parameters will be passed as the
<strong>s</strong>implest Lua type, while if <code>argcode</code> is
<code>&quot;sr&quot;</code>, then the first argument has arg code
<code>&quot;s&quot;</code>, the second argument has arg code <code>&quot;r&quot;</code>, the
third argument has arg code <code>&quot;s&quot;</code>, etc.</p>
<p>When a vector (logical vector, integer vector, numeric vector, or
character vector) is passed from R to Lua by <strong>r</strong>eference,
modifications made to the elements of that passed-in vector persist back
in the R calling frame. For example:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>values <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>keep <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1] = 999 end&quot;</span>, <span class="st">&quot;v&quot;</span>) <span class="co"># passed by value</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">keep</span>(values)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">print</span>(values)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; [1] 1 2 3</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>change <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1] = 999 end&quot;</span>, <span class="st">&quot;r&quot;</span>) <span class="co"># passed by reference</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="fu">change</span>(values)</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">print</span>(values)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; [1] 999   2   3</span></span></code></pre></div>
<p>Vectors can never be resized by reference; only their
already-existing elements can be changed by reference.</p>
<p>Lists are always passed by value, but their vector elements can be
either passed by value or by reference depending on the arg code. In
order to make changes to a list, it needs to be returned to the calling
function. For example:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">1</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>f1 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1][1] = 999; x.a = 42; end&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="fu">f1</span>(x)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>f2 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1][1] = 999; x.a = 42; end&quot;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="fu">f2</span>(x)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; [1] 999</span></span></code></pre></div>
<p>Note that in the examples above, we modify <code>x[1][1]</code>, not
just <code>x[1]</code>. That is because, even when lists are passed by
reference, we need to modify specific elements of their vector elements
if we want to make changes by reference. Setting <code>x[1] = 999</code>
would only reassign an element of the list <code>x</code>, and lists
cannot be passed by reference itself, so this would have no effect on
the R object passed in. By contrast, setting <code>x[1][1] = 999</code>
modifies the passed-in vector <code>x[1]</code>, which can be passed in
by reference, so this does change the R object that is passed in.</p>
<p>To modify a list, we have to return its new value from the
function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">list</span>(<span class="dv">1</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>f3 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1][1] = 999; x.a = 42; return x; end&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">f3</span>(x)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; [1] 999</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; $a</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; [1] 42</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>f4 <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;function(x) x[1] = luajr.numeric({888, 999}); return x; end&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">f4</span>(x)</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; [1] 888 999</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; $a</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; [1] 42</span></span></code></pre></div>
<p>Here, because we are returning a modified value, we can add elements
to the list (<code>f3</code>) and change whole entries of the list
(<code>f4</code>).</p>
</div>
<div id="benchmarking" class="section level2">
<h2>Benchmarking</h2>
<p>In the same way that using R packages <a href="https://CRAN.R-project.org/package=cpp11"><code>cpp11</code></a>
or <a href="https://CRAN.R-project.org/package=Rcpp"><code>Rcpp</code></a>
allows you to bridge your R code with C++ code that runs faster than R,
you can use <code>luajr</code> to bridge your R code with Lua code that
runs faster than R.</p>
<p>In general, C/C++ code runs about 5-1,000 times faster than the
equivalent R code.</p>
<p>In my experience, <code>luajr</code> code often presents a similar
speedup, about the same as C/C++ code, or in the worst case, maybe half
as fast. Sometimes <code>luajr</code> code can be faster than C/C++,
though usually it isn’t quite as good.</p>
<p>Why use <code>luajr</code> then? <code>Rcpp</code> and
<code>cpp11</code> require a C++ toolchain (e.g.  gcc, clang, etc.) and
requires long compilation times, whereas <code>luajr</code> doesn’t.
This means that <code>luajr</code> is usable when a C++ compiler isn’t
available, or when compilation times are prohibitive or an
annoyance.</p>
<p>In the following section, we look at two aspects of benchmarking. In
the first example, we compare different ways of passing vectors to Lua
functions relative to R. In the second example, we compare more
fundamentally the difference in running a whole algorithm in Lua versus
R versus C++ with <code>Rcpp</code>.</p>
<div id="parameter-passing-example-sum-of-squares" class="section level3">
<h3>Parameter passing example: sum of squares</h3>
<p>For reasonably long vectors, passing by reference (<code>&#39;r&#39;</code>)
is faster than passing by value (<code>&#39;v&#39;</code>), which is faster than
passing by simplify (<code>&#39;s&#39;</code>, <code>&#39;a&#39;</code>, or
<code>&#39;1&#39;</code>–<code>&#39;9&#39;</code>). But for relatively short vectors,
passing by simplify can avoid some overhead, and for very simple
operations on very short vectors, it might not be worth using Lua at
all.</p>
<p>To illustrate the above points, here is some code that takes a
numeric vector and calculates the sum of squares, comparing a pure R
function with three alternatives written in Lua, respectively passing
the vector by reference, by value, and by simplify.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>v1 <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>v4 <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>v7 <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fl">1e7</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;sum2 = function(x) local s = 0; for i=1,#x do s = s + x[i]*x[i] end; return s end&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>sum2 <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">*</span>x)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>sum2_r <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;sum2&quot;</span>, <span class="st">&quot;r&quot;</span>)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>sum2_v <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;sum2&quot;</span>, <span class="st">&quot;v&quot;</span>)</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>sum2_s <span class="ot">=</span> <span class="fu">lua_func</span>(<span class="st">&quot;sum2&quot;</span>, <span class="st">&quot;s&quot;</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co"># Comparing the results of each function:</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="fu">sum2</span>(v1)    <span class="co"># Pure R version</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; [1] 4.858528</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="fu">sum2_r</span>(v1)  <span class="co"># luajr pass-by-reference</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; [1] 4.858528</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="fu">sum2_v</span>(v1)  <span class="co"># luajr pass-by-value</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; [1] 4.858528</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="fu">sum2_s</span>(v1)  <span class="co"># luajr pass-by-simplify</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; [1] 4.858528</span></span></code></pre></div>
<p>The time taken to sum <code>v1</code>, <code>v4</code> and
<code>v7</code>, depending upon the function kind, on a 2019-era MacBook
Pro is summarised in this table:</p>
<table>
<colgroup>
<col width="20%" />
<col width="24%" />
<col width="34%" />
<col width="20%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Call</th>
<th align="center">Number of summands</th>
<th align="center">Method</th>
<th align="right">Median runtime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>sum2(v1)</code></td>
<td align="center">10</td>
<td align="center">Pure R</td>
<td align="right"><strong>1 µs</strong></td>
</tr>
<tr class="even">
<td align="left"><code>sum2_r(v1)</code></td>
<td align="center">10</td>
<td align="center"><code>luajr</code> pass by reference</td>
<td align="right">6 µs</td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_v(v1)</code></td>
<td align="center">10</td>
<td align="center"><code>luajr</code> pass by value</td>
<td align="right">7 µs</td>
</tr>
<tr class="even">
<td align="left"><code>sum2_s(v1)</code></td>
<td align="center">10</td>
<td align="center"><code>luajr</code> pass by simplify</td>
<td align="right">4 µs</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left"><code>sum2(v4)</code></td>
<td align="center">10,000</td>
<td align="center">Pure R</td>
<td align="right">63 µs</td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_r(v4)</code></td>
<td align="center">10,000</td>
<td align="center"><code>luajr</code> pass by reference</td>
<td align="right"><strong>18 µs</strong></td>
</tr>
<tr class="even">
<td align="left"><code>sum2_v(v4)</code></td>
<td align="center">10,000</td>
<td align="center"><code>luajr</code> pass by value</td>
<td align="right">93 µs</td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_s(v4)</code></td>
<td align="center">10,000</td>
<td align="center"><code>luajr</code> pass by simplify</td>
<td align="right">78 µs</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="center"></td>
<td align="center"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left"><code>sum2(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center">Pure R</td>
<td align="right">49,000 µs</td>
</tr>
<tr class="even">
<td align="left"><code>sum2_r(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center"><code>luajr</code> pass by reference</td>
<td align="right"><strong>13,000 µs</strong></td>
</tr>
<tr class="odd">
<td align="left"><code>sum2_v(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center"><code>luajr</code> pass by value</td>
<td align="right">96,000 µs</td>
</tr>
<tr class="even">
<td align="left"><code>sum2_s(v7)</code></td>
<td align="center">10,000,000</td>
<td align="center"><code>luajr</code> pass by simplify</td>
<td align="right">124,000 µs</td>
</tr>
</tbody>
</table>
<p>When the vector is 10 elements long, the R version wins handily.</p>
<p>When the vector is 10,000 elements long, the pass-by-reference Lua
version is fastest, but the other methods are all comparable.</p>
<p>When the vector is 10,000,000 elements long, the story is
similar.</p>
<p>This is an example where <code>luajr</code> doesn’t add that much
speed—the function is relatively short, and there is a certain amount of
overhead in invoking it, while the R function doesn’t have the overhead
of transferring control between languages.</p>
</div>
<div id="processing-time-example-logistic-map" class="section level3">
<h3>Processing time example: logistic map</h3>
<p>Consider the following:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>logistic_map_R <span class="ot">=</span> <span class="cf">function</span>(x0, burn, iter, A)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>{</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    result_x <span class="ot">=</span> <span class="fu">numeric</span>(<span class="fu">length</span>(A) <span class="sc">*</span> iter)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    </span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    j <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="cf">for</span> (a <span class="cf">in</span> A) {</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>        x <span class="ot">=</span> x0</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>burn) { </span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>            x <span class="ot">=</span> a <span class="sc">*</span> x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x)</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>        }</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>iter) { </span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>            result_x[j] <span class="ot">=</span> x</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>            x <span class="ot">=</span> a <span class="sc">*</span> x <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x)</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>            j <span class="ot">=</span> j <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>        }</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>    }</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    </span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>    <span class="fu">return</span> (<span class="fu">list2DF</span>(<span class="fu">list</span>(<span class="at">a =</span> <span class="fu">rep</span>(A, <span class="at">each =</span> iter), <span class="at">x =</span> result_x)))</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>}</span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>logistic_map_L <span class="ot">=</span> <span class="fu">lua_func</span>(</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="st">&quot;function(x0, burn, iter, A)</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="st">    local dflen = #A * iter</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="st">    local result = luajr.dataframe()</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="st">    result.a = luajr.numeric_r(dflen, 0)</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="st">    result.x = luajr.numeric_r(dflen, 0)</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="st">    local j = 1</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="st">    for k,a in pairs(A) do</span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="st">        local x = x0</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="st">        for i = 1, burn do</span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="st">            x = a * x * (1 - x)</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="st">        end</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="st">        for i = 1, iter do</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="st">            result.a[j] = a</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="st">            result.x[j] = x</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="st">            x = a * x * (1 - x)</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="st">            j = j + 1</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a><span class="st">        end</span></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="st">    end</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="st">    return result</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="st">end&quot;</span>, <span class="st">&quot;sssr&quot;</span>)</span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a><span class="co"># To be compiled using Rcpp::cppFunction()</span></span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a>logistic_map_C <span class="ot">=</span></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a><span class="st">&#39;DataFrame logistic_map(double x0, unsigned int burn, unsigned int iter, NumericVector A)</span></span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a><span class="st">{</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a><span class="st">    unsigned int dflen = A.length() * iter;</span></span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a><span class="st">    NumericVector da(dflen, 0);</span></span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a><span class="st">    NumericVector dx(dflen, 0);</span></span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a><span class="st">    unsigned int j = 0;</span></span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a><span class="st">    for (auto a : A)</span></span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a><span class="st">    {</span></span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a><span class="st">        double x = x0;</span></span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a><span class="st">        for (unsigned int i = 0; i &lt; burn; ++i)</span></span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a><span class="st">            x = a * x * (1 - x);</span></span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a><span class="st">        for (unsigned int i = 0; i &lt; iter; ++i, ++j)</span></span>
<span id="cb13-60"><a href="#cb13-60" tabindex="-1"></a><span class="st">        {</span></span>
<span id="cb13-61"><a href="#cb13-61" tabindex="-1"></a><span class="st">            dx[j] = x;</span></span>
<span id="cb13-62"><a href="#cb13-62" tabindex="-1"></a><span class="st">            da[j] = a;</span></span>
<span id="cb13-63"><a href="#cb13-63" tabindex="-1"></a><span class="st">            x = a * x * (1 - x);</span></span>
<span id="cb13-64"><a href="#cb13-64" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb13-65"><a href="#cb13-65" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb13-66"><a href="#cb13-66" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" tabindex="-1"></a><span class="st">    return DataFrame::create(Named(&quot;a&quot;) = da, Named(&quot;x&quot;) = dx);</span></span>
<span id="cb13-68"><a href="#cb13-68" tabindex="-1"></a><span class="st">}&#39;</span></span></code></pre></div>
<p>Here we are comparing three different versions (R, Lua, C++) of
running a parameter sweep of the logistic map, a chaotic dynamical
system popularized by Bob May in a <a href="https://abel.math.harvard.edu/archive/118r_spring_05/docs/may.pdf">1976
Nature article</a>. The output looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>logistic_map <span class="ot">=</span> <span class="fu">logistic_map_L</span>(<span class="fl">0.5</span>, <span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">200</span><span class="sc">:</span><span class="dv">385</span><span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">plot</span>(logistic_map<span class="sc">$</span>a, logistic_map<span class="sc">$</span>x, <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<p><img role="img" aria-label="Plot of fixed points of the logistic map chaotic dynamical system. The input x-axis value a ranges from 2.0 to 3.85. Between 2.0 and  3.0 there is a single fixed point; above 3.0 the fixed points exhibit bifurcations and chaotic behaviour." src="data:image/png;base64,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LF68WN55552E//zen7gxoicPPvigVKxYUYYMGSLPPPOMHHrooTJq1KiIpjZ+ydonfklmioMkcPHFF8txxx2XURSoGTRv3lzGjx8vLVq00Pfk5/6MIgnR00cffST9+/eXe++9V6pUqSJff/21/P3333LHHXfIhRdeKIccckiIqcuNqClAufEciywXo0ePzjgsx3EEP9vk5377viiev/XWW7LffvtJ3759ZcaMGVKsWDG56aab5LvvvpN169ZRgIrgobEJVgQQoxIEmkKtWrWSMmXKSK1atfR/7127diWSh//e+G9ev359Oeyww+SGG26QcePGyQUXXJDw06ZNG3n22WcT10888YQcddRRsv/+++v7HnvsMe32+++/S9OmTfX54MGDpXv37vrcff+vv/4qffr0kTp16ug0ofawYcOGRPh+J0jvgAEDZMKECVKvXj05/PDDdV8MhO/xxx+Xo48+WurWrSuPPPJIUlAQiHPPPVeqVq0qBxxwgDRs2FBeeOGFhB80HRs1aiRLlizRtbiDDz5Y12qWLVuW8AM79Pl8//33CTtwALPGjRsn7F555RVdAyxXrpzm2qFDB/nyyy8T7jxJQ0A9SJoYElAvPaoejiocOvUff/yxs/feezsdO3Z0Xn75ZUcVSOfAAw90zjzzzETu7rnnHqdkyZKO6tdwpk6d6qjmk6MKlKMKcMJP2bJlHdXhqq9nzpyp47j99tsdxKf+++trJQbO7t27naefflpf9+zZ04FfGPv+//73v85ZZ53lVKpUyVHNNO2/Zs2aTqdOnbTfTP4gbNUH49SuXdtRfS/OVVddpeM85ZRTHCWMOp9XXnmltlPioYPcsWOHo/qidP5Uv40zZswYR4ml9rNixQrtZ+7cufq6QoUKzkMPPeQsWLDAOeOMM5zKlSs7P/30k/azfv16HY4SOee6665zhg4dmifJ06ZN0+FcffXVDs7vuusuR/UTOcccc0wev7TISwBVaJoYEnALkKr5OCeccIKjajmJ3Bg/KFwQKgjU3XffnXD/7bffHBTAY489NmFnC8gtt9ziqJpUwg0nt956qzNp0iRtp2pXuvBBkIyx71fNFu2+dOlS46wLOkRP1RASdulOIEAQ2pUrVya8VatWTdutWbMmYQfhULUlfT1nzhxH1Xwc1WeTcF+1apW+Z+zYsdrOCJCqvSX8qNqO5tGvX7+E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" alt="Plot of fixed points of the logistic map chaotic dynamical system. The input x-axis value a ranges from 2.0 to 3.85. Between 2.0 and  3.0 there is a single fixed point; above 3.0 the fixed points exhibit bifurcations and chaotic behaviour." /></p>
<p>In the code above, we don’t actually compile the C++ code using
<code>Rcpp</code>, we only declare the source code as an illustration. I
don’t actually compile the code in this article because I didn’t want to
have <code>luajr</code> depend on <code>Rcpp</code> only for the sake of
this vignette, but you would do so using
<code>Rcpp::cppFunction(logistic_map_C)</code>.</p>
<p>The times taken by each function on a 2025-era MacBook Pro are as
follows:</p>
<table>
<colgroup>
<col width="60%" />
<col width="18%" />
<col width="21%" />
</colgroup>
<thead>
<tr class="header">
<th>Call</th>
<th>Method</th>
<th align="right">Median runtime</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>logistic_map_R(0.5, 100, 100, 200:385/100))</code></td>
<td>R function</td>
<td align="right">850 µs</td>
</tr>
<tr class="even">
<td><code>logistic_map_L(0.5, 100, 100, 200:385/100))</code></td>
<td>Lua function</td>
<td align="right"><strong>80 µs</strong></td>
</tr>
<tr class="odd">
<td><code>logistic_map_C(0.5, 100, 100, 200:385/100))</code></td>
<td>C++ function</td>
<td align="right">100 µs</td>
</tr>
</tbody>
</table>
<p>The version written in Lua is around 10 times faster than the version
in R, and even somewhat outperforms <code>Rcpp</code>. Note that the
relative speed of Lua versus C++ depends on the number of iterations,
and whether you use <code>Rcpp</code> or <code>cpp11</code>, which each
seem to have marginal advantages in different cases. Nonetheless, the
Lua version seems to execute about as quickly as the C++ version, within
plus or minus 20%.</p>
<p>The speedup of the Lua function relative to R was much more notable
in an earlier test where the R version first created the data frame and
then performed the iteration, i.e. with the line
<code>result$x[j] = x</code> instead of <code>result_x[j] = x</code>.
The median runtime for that R version was two orders of magnitude slower
than the Lua version; the extra overhead associated with
<code>data.frame</code> methods was pointed out by Tim Taylor.</p>
</div>
</div>
<div id="states" class="section level2">
<h2>Working with Lua States: <code>lua_open()</code>,
<code>lua_reset()</code></h2>
<p>All the functions mentioned above (<code>lua()</code>,
<code>lua_shell()</code>, and <code>lua_func()</code>) can also take an
argument <code>L</code> that specifies a particular Lua state that the
function operates in.</p>
<p>When <code>L = NULL</code> (the default) the functions operate on the
default Lua state.</p>
<p>But you can also open alternative Lua states using
<code>lua_open()</code>, and then by passing the result as the parameter
<code>L</code>, specify that the function operates in that specific
state. For example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>L1 <span class="ot">=</span> <span class="fu">lua_open</span>()</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;a = 2&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;a = 4&quot;</span>, <span class="at">L =</span> L1)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>, <span class="at">L =</span> L1)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>There is no <code>lua_close</code> in <code>luajr</code> because Lua
states are closed automatically when they are garbage collected in
R.</p>
<p><code>lua_reset()</code> resets the default Lua state:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;a = 2&quot;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">lua_reset</span>()</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="fu">lua</span>(<span class="st">&quot;return a&quot;</span>)</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>To reset a non-default Lua state <code>L</code> returned by
<code>lua_open()</code>, just do <code>L = lua_open()</code> again. The
memory previously used by <code>L</code> will be cleaned up at the next
garbage collection.</p>
</div>
<div id="further-reading" class="section level2">
<h2>Further reading</h2>
<p>For notes on how to create and manipulate R objects – such as
vectors, lists, and data.frames – in your Lua code, see the <a href="objects.html">R objects in Lua code</a> vignette.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
